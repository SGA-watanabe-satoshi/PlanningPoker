machine:
  node:
    version: v0.12.7
  environment:
    COVERALLS_SERVICE_NAME: circle-ci
    COVERALLS_REPO_TOKEN: FfVHaNrYClfyi8SObetsIBWcZIHIbEJOq
test:
  pre:
    - npm install -g grunt-cli
    - npm install -g typescript@1.4.1
  post:
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - find . -type f -regex ".*/output/junit-reports/TEST.*\.xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;
    - grunt coveralls
    - mv output/cobertura-reports/cobertura-coverage.xml $CIRCLE_ARTIFACTS
    - mv output/coverage-html-reports $CIRCLE_ARTIFACTS
deployment:
  production:
    branch: develop
    commands:
      - grunt clean:all
      - grunt ts:base
      - git branch -rd origin/gh-pages
      - git checkout -b gh-pages
      - git push origin gh-pages
